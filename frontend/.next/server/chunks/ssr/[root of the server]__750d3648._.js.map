{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///home/nindang/Documents/SocialNetwork/frontend/src/app/comment/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useRouter, useParams } from \"next/navigation\";\nimport axios from \"axios\";\nimport { MessageCircle, Heart, Repeat, Image, ArrowLeftIcon, Video } from \"lucide-react\";\nimport { ReactNode } from \"react\";\n\nexport default function CommentPage() {\n  const router = useRouter();\n  const params = useParams();\n  const id = params.id;\n  const [newComment, setNewComment] = useState(\"\");\n  const [showReply, setShowReply] = useState(false);\n  const [replyTo, setReplyTo] = useState(\"\");\n  const [liked, setLiked] = useState(false);\n  const [likeCount, setLikeCount] = useState(0);\n  const [reposted, setReposted] = useState(false);\n  const [repostCount, setRepostCount] = useState(0);\n  const [comments, setComments] = useState(0);\n  const [showComment, setShowComment] = useState(false);\n  const [replyLikes, setReplyLikes] = useState<{ [key: string]: boolean }>({});\n  const [replyLikeCounts, setReplyLikeCounts] = useState<{ [key: string]: number }>({});\n  const [replyReplies, setReplyReplies] = useState<{ [key: string]: any[] }>({});\n  const [replyInputs, setReplyInputs] = useState<{ [key: string]: string }>({});\n  const [showInputReply, setShowInputReply] = useState<{ [key: string]: boolean }>({});\n  const [post, setPost] = useState<any>(null);\n  const [user, setUser] = useState<any>(null);\n  const [currentUser, setCurrentUser] = useState<any>(null);\n  const [commentList, setCommentList] = useState<any[]>([]);\n  const [commentLikes, setCommentLikes] = useState<{ [key: string]: boolean }>({});\n  const [commentLikeCounts, setCommentLikeCounts] = useState<{ [key: string]: number }>({});\n  const [commentImage, setCommentImage] = useState<File | null>(null);\n  const [commentVideo, setCommentVideo] = useState<File | null>(null);\n  const [showMedia, setShowMedia] = useState<{ [key: string]: boolean }>({});\n  const [replyImages, setReplyImages] = useState<{ [key: string]: File | null }>({});\n  const [replyVideo, setReplyVideo] = useState<{ [key: string]: File | null }>({});\n  const [commentError, setCommentError] = useState(\"\");\n\n  const handleComment = async () => {\n    if (!newComment.trim() && !commentImage && !commentVideo) {\n      setCommentError('Vui lòng nhập nội dung bình luận!');\n      return;\n    }\n    setCommentError(\"\");\n    try {\n      const token = localStorage.getItem('token');\n      const formData = new FormData();\n      formData.append(\"content\", newComment);\n      if (commentImage) {\n        formData.append(\"image\", commentImage);\n      }\n      if (commentVideo) {\n        formData.append(\"video\", commentVideo);\n      }\n      const response = await fetch(`http://127.0.0.1:8000/posts/${id}/comment`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n        body: formData,\n      });\n      if (!response.ok) throw new Error('Failed to comment');\n      const data = await response.json();\n      setCommentList(prev => [...prev, data]);\n      setCommentImage(null); // reset image\n      setCommentVideo(null); // reset video\n    } catch (error) {\n      console.error('Error commenting:', error);\n    }\n  };\n\n  const handleReply = (username: string) => {\n    // TODO: Implement reply functionality\n  };\n\n  const toggleReplyInput = async (commentId: string) => {\n    setShowInputReply(prev => ({\n      ...prev,\n      [commentId]: !prev[commentId]\n    }));\n\n    // Nếu chưa có reply cho comment này thì fetch\n    if (!replyReplies[commentId]) {\n      try {\n        const token = localStorage.getItem('token');\n        const res = await fetch(`http://127.0.0.1:8000/comments/${commentId}/replied`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        });\n        if (res.ok) {\n          const data = await res.json();\n          setReplyReplies(prev => ({\n            ...prev,\n            [commentId]: data\n          }));\n        }\n      } catch (err) {\n        console.error(\"Error fetching replies:\", err);\n      }\n    }\n  };\n\n  const handleLike = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      const response = await fetch(`http://127.0.0.1:8000/posts/${id}/like`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      if (!response.ok) throw new Error('Failed to like post');\n      const data = await response.json();\n\n      if (data && data.liked_by && currentUser) {\n        const userHasLiked = data.liked_by\n          .map((id: string) => String(id).trim())\n          .includes(String(currentUser.user_id).trim());\n        setLiked(userHasLiked);\n        setLikeCount(data.likes ?? 0);\n      }\n    } catch (error) {\n      console.error('Error liking post:', error);\n    }\n  };\n\n  const handleRepost = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      const response = await fetch(`http://127.0.0.1:8000/posts/${id}/repost`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      if (!response.ok) throw new Error('Failed to repost');\n      const data = await response.json();\n\n      if (data && data.reposted_by && currentUser) {\n        const userHasReposted = data.reposted_by\n          .map((id: string) => String(id).trim())\n          .includes(String(currentUser.user_id).trim());\n        setReposted(userHasReposted);\n        setRepostCount(data.reposts ?? 0);\n      }\n    } catch (error) {\n      console.error('Error reposting:', error);\n    }\n  };\n\n  const handleReplyLike = (replyId: string) => {\n    setReplyLikes((prev) => ({\n      ...prev,\n      [replyId]: !prev[replyId],\n    }));\n    setReplyLikeCounts((prev) => ({\n      ...prev,\n      [replyId]: prev[replyId] ? prev[replyId] - 1 : (prev[replyId] || 0) + 1,\n    }));\n  };\n\n  const handleReplyInputChange = (replyId: string, value: string) => {\n    setReplyInputs((prev) => ({\n      ...prev,\n      [replyId]: value,\n    }));\n  };\n\n  const handleReplySubmit = async (postId: number, commentId: string) => {\n    try {\n      const token = localStorage.getItem('token');\n      const formData = new FormData();\n      formData.append(\"content\", replyInputs[commentId]);\n      if (replyImages[commentId]) {\n        formData.append(\"image\", replyImages[commentId]!);\n      }\n      if (replyVideo[commentId]) {\n        formData.append(\"video\", replyVideo[commentId]!);\n      }\n      const response = await fetch(`http://127.0.0.1:8000/comments/${commentId}/reply`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n        body: formData,\n      });\n      if (!response.ok) throw new Error('Failed to reply');\n      const data = await response.json();\n      setReplyReplies(prev => ({\n        ...prev,\n        [commentId]: [...(prev[commentId] || []), data],\n      }));\n      setReplyInputs(prev => ({\n        ...prev,\n        [commentId]: \"\",\n      }));\n      setReplyImages(prev => ({\n        ...prev,\n        [commentId]: null,\n      }));\n      setReplyVideo(prev => ({\n        ...prev,\n        [commentId]: null,\n      }));\n    } catch (error) {\n      console.error('Error replying:', error);\n    }\n  };\n\n  const handleLikeComment = async (commentId: string) => {\n    try {\n      const token = localStorage.getItem('token');\n      const response = await fetch(`http://127.0.0.1:8000/comments/${commentId}/like`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to like comment');\n      const data = await response.json();\n\n      // data.liked_by là mảng user_id đã like comment này\n      const userHasLiked = data.liked_by\n        .map((id: string) => String(id).trim())\n        .includes(String(currentUser.user_id).trim());\n\n      setCommentLikes(prev => ({ ...prev, [commentId]: userHasLiked }));\n      setCommentLikeCounts(prev => ({ ...prev, [commentId]: data.likes ?? 0 }));\n    } catch (error) {\n      console.error('Error liking comment:', error);\n    }\n  };\n\n  const fetchReplies = async (commentId: string) => {\n    try {\n      const token = localStorage.getItem('token');\n      const res = await fetch(`http://127.0.0.1:8000/comments/${commentId}/replied`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      if (res.ok) {\n        const data = await res.json();\n        setReplyReplies(prev => ({\n          ...prev,\n          [commentId]: data\n        }));\n      }\n    } catch (err) {\n      console.error(\"Error fetching replies:\", err);\n    }\n  };\n\n  function formatTime(createdAt: string) {\n    const now = new Date();\n    const postDate = new Date(createdAt);\n    const diffInMs = now.getTime() - postDate.getTime();\n    const diffInMinutes = Math.floor(diffInMs / (1000 * 60));\n    if (diffInMinutes < 1) {\n      return \"vừa xong\";\n    } else if (diffInMinutes < 60) {\n      return `${diffInMinutes} phút`;\n    } else if (diffInMinutes < 1440) {\n      const diffInHours = Math.floor(diffInMinutes / 60);\n      return `${diffInHours} giờ`;\n    } else {\n      const diffInDays = Math.floor(diffInMinutes / 1440);\n      return `${diffInDays} ngày`;\n    }\n  }\n\n  useEffect(() => {\n    const fetchPost = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        const response = await axios.get(`http://127.0.0.1:8000/posts/${id}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        });\n        setPost(response.data);\n\n        // Kiểm tra liked_by và reposted_by nếu đã có currentUser\n        if (response.data.liked_by && currentUser) {\n          const userHasLiked = response.data.liked_by\n            .map((id: string) => String(id).trim())\n            .includes(String(currentUser.user_id).trim());\n          setLiked(userHasLiked);\n          setLikeCount(response.data.likes ?? 0);\n        } else {\n          setLiked(false);\n          setLikeCount(response.data.likes ?? 0);\n        }\n\n        if (response.data.reposted_by && currentUser) {\n          const userHasReposted = response.data.reposted_by\n            .map((id: string) => String(id).trim())\n            .includes(String(currentUser.user_id).trim());\n          setReposted(userHasReposted);\n          setRepostCount(response.data.reposts ?? 0);\n        } else {\n          setReposted(false);\n          setRepostCount(response.data.reposts ?? 0);\n        }\n      } catch (err) {\n        console.error(\"Error fetching post:\", err);\n      }\n    };\n    fetchPost();\n  }, [id, currentUser]);\n\n  useEffect(() => {\n    if (!post?.user_id) return;\n    const fetchUser = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        const response = await axios.get(`http://127.0.0.1:8000/users/${post.user_id}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        });\n        setUser(response.data.user);\n      } catch (err) {\n        console.error(\"Error fetching user:\", err);\n      }\n    };\n    fetchUser();\n  }, [post]);\n\n  useEffect(() => {\n    const fetchCurrentUser = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        const response = await axios.get(\"http://127.0.0.1:8000/users/me\", {\n          headers: { 'Authorization': `Bearer ${token}` }\n        });\n        setCurrentUser(response.data.user);\n      } catch (err) {\n        console.error(\"Error fetching current user:\", err);\n      }\n    };\n    fetchCurrentUser();\n  }, []);\n\n  useEffect(() => {\n    if (!post?._id && !post?.post_id && id) return;\n    const fetchComments = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        const res = await axios.get(\n          `http://127.0.0.1:8000/posts/${post.post_id || post._id || id}/comments`,\n          { headers: { 'Authorization': `Bearer ${token}` } }\n        );\n        setCommentList(res.data);\n\n        // Cập nhật trạng thái like cho từng comment\n        if (currentUser) {\n          const likesObj: { [key: string]: boolean } = {};\n          const likeCountsObj: { [key: string]: number } = {};\n          res.data.forEach((cmt: any) => {\n            likesObj[cmt.comment_id] = cmt.liked_by?.includes(currentUser.user_id);\n            likeCountsObj[cmt.comment_id] = cmt.likes ?? 0;\n          });\n          setCommentLikes(likesObj);\n          setCommentLikeCounts(likeCountsObj);\n        }\n      } catch (err) {\n        console.error(\"Error fetching comments:\", err);\n      }\n    };\n    fetchComments();\n  }, [post, id, currentUser]);\n\n  // Thêm logic cập nhật/xóa comment\n  const handleEditComment = (commentId: string, newContent: string) => {\n    setCommentList(prev => prev.map(cmt =>\n      cmt.comment_id === commentId ? { ...cmt, content: newContent } : cmt\n    ));\n    // Nếu là reply thì cập nhật trong replyReplies\n    setReplyReplies(prev => {\n      const updated = { ...prev };\n      Object.keys(updated).forEach(key => {\n        updated[key] = updated[key]?.map((reply: any) =>\n          reply.comment_id === commentId ? { ...reply, content: newContent } : reply\n        );\n      });\n      return updated;\n    });\n  };\n  const handleDeleteComment = (commentId: string) => {\n    setCommentList(prev => prev.filter(cmt => cmt.comment_id !== commentId));\n    setReplyReplies(prev => {\n      const updated = { ...prev };\n      Object.keys(updated).forEach(key => {\n        updated[key] = updated[key]?.filter((reply: any) => reply.comment_id !== commentId);\n      });\n      return updated;\n    });\n  };\n\n  return (\n    <div className=\"w-full h-screen bg-gray-100 flex flex-col items-center p-4\">\n      <div className=\"min-w-xl flex items-center justify-between gap-4 mb-4\">\n        <ArrowLeftIcon size={24} className=\"cursor-pointer\" onClick={() => window.history.back()} />\n        <h1 className=\"text-xl font-bold mb-4\">Bình luận</h1>\n        <div></div>\n      </div>\n      <div className=\"max-w-xl w-full h-auto\">\n        <div className=\"bg-white rounded-2xl shadow-md p-4 space-y-4\">\n          {/* Post content */}\n          <div className=\"border-b pb-4\">\n            <div className=\"flex items-center space-x-3\">\n              <img src={user?.avatar || \"https://placehold.co/40x40\"} alt=\"Avatar\" className=\"w-10 h-10 rounded-full\" />\n              <div>\n                <p className=\"font-semibold\">{user?.username || \"username\"}</p>\n                <p className=\"text-sm text-gray-500\">{post?.created_at ? formatTime(post.created_at) : \"time\"}</p>\n              </div>\n            </div>\n            <p className=\"mt-2\">{post?.content || \"content\"}</p>\n            {post?.image && <img src={post.image} alt=\"Post\" className=\"mt-2 rounded-lg\" />}\n\n            {/* Action Buttons */}\n            <div className=\"flex gap-4 text-gray-500 mt-3\">\n              <ActionButton \n                icon={<Heart size={18} className={liked ? \"text-red-500\" : \"text-gray-500\"} />} \n                count={likeCount} \n                onClick={handleLike}\n              />\n              <ActionButton \n                icon={<MessageCircle size={18} />} \n                count={post?.comments ?? 0} \n                onClick={() => {}} // hoặc mở khung comment nếu muốn\n              />\n              <ActionButton \n                icon={<Repeat size={18} className={reposted ? \"text-green-500\" : \"text-gray-500\"} />} \n                count={repostCount} \n                onClick={handleRepost}\n              />\n            </div>\n          </div>\n\n          {/* Comments list */}\n          <div className=\"space-y-4 overflow-y-auto p-2 max-h-[470px]\">\n            {commentList.length === 0 && (\n              <div className=\"text-gray-400 text-sm\">Chưa có bình luận nào.</div>\n            )}\n            {commentList.map((cmt: any) => (\n              <CommentItem\n                key={cmt.comment_id || cmt._id}\n                cmt={cmt}\n                currentUser={currentUser}\n                commentLikes={commentLikes}\n                commentLikeCounts={commentLikeCounts}\n                handleLikeComment={handleLikeComment}\n                showInputReply={showInputReply}\n                toggleReplyInput={toggleReplyInput}\n                replyInputs={replyInputs}\n                setReplyInputs={setReplyInputs}\n                handleReplySubmit={handleReplySubmit}\n                replyReplies={replyReplies}\n                fetchReplies={fetchReplies}\n                formatTime={formatTime}\n                onEditComment={handleEditComment}\n                onDeleteComment={handleDeleteComment}\n                showMedia={showMedia}\n                setShowMedia={setShowMedia}\n                replyImages={replyImages}\n                setReplyImages={setReplyImages}\n                replyVideo={replyVideo}\n                setReplyVideo={setReplyVideo}\n              />\n            ))}\n          </div>\n\n          {/* Comment input */}\n          <div className=\"flex items-start space-x-3\">\n            <img src=\"https://placehold.co/40x40\" alt=\"Avatar\" className=\"w-10 h-10 rounded-full\" />\n            <div className=\"flex-1\">\n              <input\n                type=\"text\"\n                placeholder=\"Viết bình luận...\"\n                className=\"w-full p-2 border rounded-lg focus:outline-none\"\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n              />\n              {/* Hiển thị lỗi nếu có */}\n              {commentError && (\n                <div className=\"text-red-500 text-xs mt-1\">{commentError}</div>\n              )}\n              <div className=\"flex items-center mt-2 gap-2\">\n                <label className=\"cursor-pointer\">\n                  <Image size={20} className=\"hover:text-black\" />\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    style={{ display: 'none' }}\n                    onChange={e => setCommentImage(e.target.files?.[0] || null)}\n                  />\n                </label>\n                <label className=\"cursor-pointer\">\n                  <Video size={20} className=\"hover:text-black\" />\n                  <input\n                    type=\"file\"\n                    accept=\"video/*\"\n                    style={{ display: 'none' }}\n                    onChange={e => setCommentVideo(e.target.files?.[0] || null)}\n                  />\n                </label>\n                {/* Hiển thị preview ảnh nếu có */}\n                {commentImage && (\n                  <div className=\"relative w-10 h-10\">\n                    <img\n                      src={URL.createObjectURL(commentImage)}\n                      alt=\"preview\"\n                      className=\"w-10 h-10 object-cover rounded\"\n                    />\n                    <button\n                      type=\"button\"\n                      className=\"absolute top-0 right-0 bg-white rounded-full p-0.5 text-xs text-red-500 border border-gray-300 hover:bg-gray-200\"\n                      onClick={() => setCommentImage(null)}\n                    >\n                      ×\n                    </button>\n                  </div>\n                )}\n                {/* Hiển thị preview video nếu có */}\n                {commentVideo && (\n                  <div className=\"relative w-16 h-10\">\n                    <video\n                      src={URL.createObjectURL(commentVideo)}\n                      className=\"w-16 h-10 object-cover rounded\"\n                      controls\n                    />\n                    <button\n                      type=\"button\"\n                      className=\"absolute top-0 right-0 bg-white rounded-full p-0.5 text-xs text-red-500 border border-gray-300 hover:bg-gray-200\"\n                      onClick={() => setCommentVideo(null)}\n                    >\n                      ×\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n            <button\n              className=\"bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold\"\n              onClick={async () => {\n                await handleComment();\n                setNewComment(''); // Reset input after comment is posted\n              }}\n            >\n              Đăng\n            </button>\n          </div>\n\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction ActionButton({ icon, count, onClick }: { icon: ReactNode; count: number; onClick: () => void }) {\n  return (\n    <button onClick={onClick} className=\"flex items-center space-x-1 text-gray-500 hover:text-black\">\n      {icon}\n      <span className=\"text-sm\">{count}</span>\n    </button>\n  );\n}\n\nfunction CommentItem({\n  cmt,\n  currentUser,\n  commentLikes,\n  commentLikeCounts,\n  handleLikeComment,\n  showInputReply,\n  toggleReplyInput,\n  replyInputs,\n  setReplyInputs,\n  handleReplySubmit,\n  replyReplies,\n  fetchReplies,\n  formatTime,\n  depth = 0,\n  onEditComment,\n  onDeleteComment,\n  showMedia,\n  setShowMedia,\n  replyImages,\n  setReplyImages,\n  replyVideo,\n  setReplyVideo,\n}: any) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(cmt.content);\n  const [commentUser, setCommentUser] = useState<any>(null);\n\n  // Fetch user info for comment\n  useEffect(() => {\n    const fetchCommentUser = async () => {\n      try {\n        const token = localStorage.getItem('token');\n        const response = await axios.get(`http://127.0.0.1:8000/users/${cmt.user_id}`, {\n          headers: { 'Authorization': `Bearer ${token}` }\n        });\n        setCommentUser(response.data.user);\n      } catch (err) {\n        console.error(\"Error fetching comment user:\", err);\n      }\n    };\n    fetchCommentUser();\n  }, [cmt.user_id]);\n\n  // Hàm cập nhật comment\n  const handleEditSave = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      const formData = new FormData();\n      formData.append('content', editValue);\n      const response = await fetch(`http://127.0.0.1:8000/comments/${cmt.comment_id}`, {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n        body: formData,\n      });\n      if (!response.ok) throw new Error('Failed to edit comment');\n      const data = await response.json();\n      setIsEditing(false);\n      if (onEditComment) onEditComment(cmt.comment_id, data.content);\n    } catch (error) {\n      console.error('Error editing comment:', error);\n    }\n  };\n\n  // Hàm xóa comment\n  const handleDelete = async () => {\n    if (!window.confirm('Bạn có chắc muốn xóa bình luận này?')) return;\n    try {\n      const token = localStorage.getItem('token');\n      const response = await fetch(`http://127.0.0.1:8000/comments/${cmt.comment_id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to delete comment');\n      if (onDeleteComment) onDeleteComment(cmt.comment_id);\n    } catch (error) {\n      console.error('Error deleting comment:', error);\n    }\n  };\n\n  return (\n    <div\n      style={{ marginLeft: depth * 10, maxWidth: \"100%\" }}\n      className=\"flex flex-col items-start mt-2 border-b pb-2 w-full\"\n    >\n      <div className=\"flex items-center gap-2 w-full\">\n        <img src={commentUser?.avatar || \"https://placehold.co/40x40\"} alt=\"Avatar\" className=\"w-8 h-8 rounded-full\" />\n        <span className=\"font-semibold text-sm\">{commentUser?.username || \"user\"}</span>\n        <span className=\"text-xs text-gray-400\">\n          {cmt.created_at ? formatTime(cmt.created_at) : \"--\"}\n        </span>\n        {/* Edit/Delete option */}\n        {currentUser?.user_id === cmt.user_id && (\n          <div className=\"ml-auto flex gap-2\">\n            {!isEditing && (\n              <>\n                <button className=\"text-blue-500 text-xs\" onClick={() => setIsEditing(true)}>Sửa</button>\n                <button className=\"text-red-500 text-xs\" onClick={handleDelete}>Xóa</button>\n              </>\n            )}\n          </div>\n        )}\n      </div>\n      <div className=\"flex-1 w-full\">\n        {isEditing ? (\n          <div className=\"flex gap-2 w-full mt-1\">\n            <input\n              type=\"text\"\n              className=\"flex-1 p-2 border rounded-lg text-sm\"\n              value={editValue}\n              onChange={e => setEditValue(e.target.value)}\n            />\n            <button className=\"bg-blue-500 text-white px-2 py-1 rounded text-xs\" onClick={handleEditSave}>Lưu</button>\n            <button className=\"bg-gray-300 text-black px-2 py-1 rounded text-xs\" onClick={() => { setIsEditing(false); setEditValue(cmt.content); }}>Hủy</button>\n          </div>\n        ) : (\n          <div className=\"text-sm mt-1 break-words\">{cmt.content}</div>\n        )}\n        {/* Hiển thị media giống bên post: luôn show ảnh hoặc video nếu có */}\n        {cmt.image_id ? (\n          <img\n            src={`http://127.0.0.1:8000/media/${cmt.image_id}`}\n            alt=\"Comment\"\n            className=\"mt-2 rounded-lg\"\n          />\n        ) : cmt.video_id ? (\n          <video\n            src={`http://127.0.0.1:8000/media/${cmt.video_id}?is_image=false`}\n            controls\n            className=\"mt-2 rounded-lg w-full\"\n          />\n        ) : null}\n      </div>\n      <div className=\"flex gap-4 text-gray-500 mt-3\">\n        <ActionButton \n          icon={<Heart size={18} className={commentLikes[cmt.comment_id] ? \"text-red-500\" : \"text-gray-500\"} />} \n          count={commentLikeCounts[cmt.comment_id] ?? 0} \n          onClick={() => handleLikeComment(cmt.comment_id)}\n        />\n        <ActionButton \n          icon={<MessageCircle size={18} />} \n          count={cmt.replies ?? 0} \n          onClick={async () => {\n            toggleReplyInput(cmt.comment_id);\n            if (!replyReplies[cmt.comment_id]) await fetchReplies(cmt.comment_id);\n          }}\n        />\n      </div>\n      {/* Render reply đệ quy */}\n      {showInputReply[cmt.comment_id] && replyReplies[cmt.comment_id]?.map((reply: any) => (\n        <CommentItem\n          key={reply.comment_id || reply._id || reply.id}\n          cmt={{\n            ...reply,\n            created_at: reply.created_at || reply.createdAt || reply.timestamp\n          }}\n          currentUser={currentUser}\n          commentLikes={commentLikes}\n          commentLikeCounts={commentLikeCounts}\n          handleLikeComment={handleLikeComment}\n          showInputReply={showInputReply}\n          toggleReplyInput={toggleReplyInput}\n          replyInputs={replyInputs}\n          setReplyInputs={setReplyInputs}\n          handleReplySubmit={handleReplySubmit}\n          replyReplies={replyReplies}\n          fetchReplies={fetchReplies}\n          formatTime={formatTime}\n          depth={depth + 1}\n          onEditComment={onEditComment}\n          onDeleteComment={onDeleteComment}\n          showMedia={showMedia}\n          setShowMedia={setShowMedia}\n          replyImages={replyImages}\n          setReplyImages={setReplyImages}\n          replyVideo={replyVideo}\n          setReplyVideo={setReplyVideo}\n        />\n      ))}\n      {/* Input reply */}\n      {showInputReply[cmt.comment_id] && (\n        <div className=\"flex items-start space-x-2 mt-2 w-[90%]\">\n          <img src={currentUser?.avatar || \"https://placehold.co/32x32\"} alt=\"Avatar\" className=\"w-8 h-8 rounded-full\" />\n          <input\n            type=\"text\"\n            className=\"flex-1 p-2 border rounded-lg text-sm\"\n            placeholder=\"Trả lời bình luận...\"\n            value={replyInputs[cmt.comment_id] || \"\"}\n            onChange={e => setReplyInputs((prev: any) => ({ ...prev, [cmt.comment_id]: e.target.value }))}\n          />\n          {/* Nút chọn ảnh */}\n          <label className=\"cursor-pointer\">\n            <Image size={20} className=\"hover:text-black\" />\n            <input\n              type=\"file\"\n              accept=\"image/*\"\n              style={{ display: 'none' }}\n              onChange={e => {\n                const file = e.target.files?.[0] || null;\n                setReplyImages((prev: any) => ({ ...prev, [cmt.comment_id]: file }));\n              }}\n            />\n          </label>\n          <label className=\"cursor-pointer\">\n            <Video size={20} className=\"hover:text-black\" />\n            <input\n              type=\"file\"\n              accept=\"video/*\"\n              style={{ display: 'none' }}\n              onChange={e => {\n                const file = e.target.files?.[0] || null;\n                setReplyVideo((prev: any) => ({ ...prev, [cmt.comment_id]: file }));\n              }}\n            />\n          </label>\n          {/* Hiển thị preview ảnh nếu có */}\n          {replyImages[cmt.comment_id] && (\n            <div className=\"relative w-10 h-10 ml-1\">\n              <img\n                src={URL.createObjectURL(replyImages[cmt.comment_id])}\n                alt=\"preview\"\n                className=\"w-10 h-10 object-cover rounded\"\n              />\n              <button\n                type=\"button\"\n                className=\"absolute top-0 right-0 bg-white rounded-full p-0.5 text-xs text-red-500 border border-gray-300 hover:bg-gray-200\"\n                onClick={() => setReplyImages((prev: any) => ({ ...prev, [cmt.comment_id]: null }))}\n              >\n                ×\n              </button>\n            </div>\n          )}\n          {/* Hiển thị preview video nếu có */}\n          {replyVideo[cmt.comment_id] && (\n            <div className=\"relative w-16 h-10 ml-1\">\n              <video\n                src={URL.createObjectURL(replyVideo[cmt.comment_id])}\n                className=\"w-16 h-10 object-cover rounded\"\n                controls\n              />\n              <button\n                type=\"button\"\n                className=\"absolute top-0 right-0 bg-white rounded-full p-0.5 text-xs text-red-500 border border-gray-300 hover:bg-gray-200\"\n                onClick={() => setReplyVideo((prev: any) => ({ ...prev, [cmt.comment_id]: null }))}\n              >\n                ×\n              </button>\n            </div>\n          )}\n          <button\n            className=\"bg-blue-500 text-white px-3 py-1 rounded-lg text-sm\"\n            onClick={() => handleReplySubmit(cmt.post_id, cmt.comment_id)}\n          >\n            Gửi\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}